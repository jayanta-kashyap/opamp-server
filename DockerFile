# Build the opamp-go poc server
FROM golang:1.23 AS builder
WORKDIR /src
RUN git clone https://github.com/open-telemetry/opamp-go.git
WORKDIR /src/opamp-go/internal/examples/server
RUN CGO_ENABLED=0 go build -o /out/opamp-poc-server .

# Minimal runtime image
FROM gcr.io/distroless/base-debian11
COPY --from=builder /out/opamp-poc-server /opamp-server
EXPOSE 4320 4321
# 4320: OpAMP WS/HTTP endpoint, 4321: poc server UI
ENTRYPOINT ["/opamp-server"]
